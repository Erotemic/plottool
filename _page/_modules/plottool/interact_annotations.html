<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>plottool.interact_annotations &mdash; plottool 1.0.0.dev1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="plottool 1.0.0.dev1 documentation" href="../../index.html" />
    <link rel="up" title="plottool" href="../plottool.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">plottool 1.0.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../plottool.html" accesskey="U">plottool</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for plottool.interact_annotations</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TODO: Rename species list to label list</span>

<span class="sd">guiback.py  -- code/ibeis/ibeis/gui</span>
<span class="sd">./resetdbs.sh</span>
<span class="sd">./dev.py --cmd --gui --db testdb1 (--setdb) &lt;-set default</span>


<span class="sd">TODO:</span>
<span class="sd">1. create a function call to create a rectangle at a given set of points</span>
<span class="sd">2.. Make 45 degree rotation - need help</span>



<span class="sd">3. Change bounding box and update continuously to the original image the new ANNOTATIONs</span>

<span class="sd">2. Make new window and frames inside, double click to pull up normal window with editing</span>
<span class="sd">start with just taking in 6 images and ANNOTATIONs</span>

<span class="sd">1. ANNOTATION ID number, then list of 4 touples</span>





<span class="sd">Interactive tool to draw mask on an image or image-like array.</span>

<span class="sd">Adapted from matplotlib/examples/event_handling/poly_editor.py</span>
<span class="sd">Jan 9 2014: taken from: https://gist.github.com/tonysyu/3090704</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Button</span>
<span class="c">#import matplotlib.image as mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span> <span class="kn">as</span> <span class="nn">math</span>
<span class="c">#from matplotlib import nxutils  # Depricated</span>
<span class="c">#from matplotlib.mlab import dist_point_to_segment</span>
<span class="c"># Scientific</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">utool</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">plottool</span> <span class="kn">import</span> <span class="n">draw_func2</span> <span class="k">as</span> <span class="n">df2</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span>


<span class="n">DEFAULT_SPECIES_TAG</span> <span class="o">=</span> <span class="s">&#39;____&#39;</span>
<span class="n">ACCEPT_SAVE_HOTKEY</span>   <span class="o">=</span> <span class="s">&#39;a&#39;</span>
<span class="n">ADD_RECTANGLE_HOTKEY</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
<span class="n">DEL_RECTANGLE_HOTKEY</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span>
<span class="n">TOGGLE_LABEL_HOTKEY</span> <span class="o">=</span> <span class="s">&#39;t&#39;</span>


<span class="k">def</span> <span class="nf">_nxutils_points_inside_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">verts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; nxutils is depricated &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">contains_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>


<div class="viewcode-block" id="verts_to_mask"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.verts_to_mask">[docs]</a><span class="k">def</span> <span class="nf">verts_to_mask</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">verts</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">h</span><span class="p">,</span> <span class="p">:</span><span class="n">w</span><span class="p">]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
    <span class="c">#mask = nxutils.points_inside_poly(points, verts)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">_nxutils_points_inside_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">verts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="vertices_under_cursor"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.vertices_under_cursor">[docs]</a><span class="k">def</span> <span class="nf">vertices_under_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create 5 ind on one point&quot;&quot;&quot;</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="apply_mask"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.apply_mask">[docs]</a><span class="k">def</span> <span class="nf">apply_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
    <span class="n">masked_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">masked_img</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">masked_img</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mf">100.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">masked_img</span>

</div>
<div class="viewcode-block" id="bbox_to_verts"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.bbox_to_verts">[docs]</a><span class="k">def</span> <span class="nf">bbox_to_verts</span><span class="p">(</span><span class="n">bbox</span><span class="p">):</span>
    <span class="c"># TODO: Can use vtool for this</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span>
                      <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">verts</span>

</div>
<div class="viewcode-block" id="verts_to_bbox"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.verts_to_bbox">[docs]</a><span class="k">def</span> <span class="nf">verts_to_bbox</span><span class="p">(</span><span class="n">verts</span><span class="p">):</span>
    <span class="n">new_bbox_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] verts[i][0][0]: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; verts[i][0][1]: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">new_bbox_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_bbox_list</span>

</div>
<div class="viewcode-block" id="basecoords_to_bbox"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.basecoords_to_bbox">[docs]</a><span class="k">def</span> <span class="nf">basecoords_to_bbox</span><span class="p">(</span><span class="n">basecoords</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">basecoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">basecoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">basecoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">x</span>
    <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">basecoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">basecoords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">y</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bbox</span>

</div>
<div class="viewcode-block" id="bbox_to_mask"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.bbox_to_mask">[docs]</a><span class="k">def</span> <span class="nf">bbox_to_mask</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">bbox</span><span class="p">):</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="n">bbox_to_verts</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">verts_to_mask</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">verts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span>

</div>
<div class="viewcode-block" id="points_center"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.points_center">[docs]</a><span class="k">def</span> <span class="nf">points_center</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
    <span class="c"># the polygons have the first point listed twice in order for them to be</span>
    <span class="c"># drawn as closed, but that point shouldn&#39;t be counted twice for computing</span>
    <span class="c"># the center (hence the [:-1] slice)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="polygon_center"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.polygon_center">[docs]</a><span class="k">def</span> <span class="nf">polygon_center</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">points_center</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="polygon_dims"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.polygon_dims">[docs]</a><span class="k">def</span> <span class="nf">polygon_dims</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="rotate_points_around"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.rotate_points_around">[docs]</a><span class="k">def</span> <span class="nf">rotate_points_around</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">):</span>
    <span class="c"># TODO: Can use vtool for this</span>
    <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
    <span class="n">augpts</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c"># correct matrix obtained from http://www.euclideanspace.com/maths/geometry/affine/aroundPoint/matrix2d/</span>
    <span class="n">rot_mat</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">ct</span><span class="p">,</span> <span class="o">-</span><span class="n">st</span><span class="p">,</span> <span class="n">ax</span> <span class="o">-</span> <span class="n">ct</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">+</span> <span class="n">st</span> <span class="o">*</span> <span class="n">ay</span><span class="p">),</span>
         <span class="p">(</span><span class="n">st</span><span class="p">,</span>  <span class="n">ct</span><span class="p">,</span> <span class="n">ay</span> <span class="o">-</span> <span class="n">st</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">-</span> <span class="n">ct</span> <span class="o">*</span> <span class="n">ay</span><span class="p">),</span>
         <span class="p">(</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>                      <span class="mi">1</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rot_mat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">augpts</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="calc_display_coords"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.calc_display_coords">[docs]</a><span class="k">def</span> <span class="nf">calc_display_coords</span><span class="p">(</span><span class="n">oldcoords</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">oldcoords</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">points_center</span><span class="p">(</span><span class="n">oldcoords</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="set_display_coords"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.set_display_coords">[docs]</a><span class="k">def</span> <span class="nf">set_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="n">poly</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">calc_tag_position</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span>
    <span class="c">#print(poly.species_tag.get_position())</span>

</div>
<div class="viewcode-block" id="calc_tag_position"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.calc_tag_position">[docs]</a><span class="k">def</span> <span class="nf">calc_tag_position</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">))[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">))[</span><span class="mi">1</span><span class="p">])]]</span>
    <span class="n">tagpos</span> <span class="o">=</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">polygon_center</span><span class="p">(</span><span class="n">poly</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tagpos</span>

</div>
<div class="viewcode-block" id="is_within_distance"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.is_within_distance">[docs]</a><span class="k">def</span> <span class="nf">is_within_distance</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx2</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">dy2</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">dist</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">dx2</span> <span class="o">+</span> <span class="n">dy2</span><span class="p">)</span>
    <span class="c">#print(&#39;is_within_distance(%r, (%r, %r), (%r, %r)) = %r&#39; % (dist, p1[0], p1[1], p2[0], p2[1], rv))</span>
    <span class="k">return</span> <span class="n">rv</span>

</div>
<div class="viewcode-block" id="is_within_distance_from_line"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.is_within_distance_from_line">[docs]</a><span class="k">def</span> <span class="nf">is_within_distance_from_line</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; http://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">pt</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="c"># # This doesn&#39;t work due to being for lines, not line segments, leading to potentially confusing behavior</span>
    <span class="c"># numer = abs((dy * x0) - (dx * y0) - (x1 * y2) + (x2 * y1))</span>
    <span class="c"># denom = math.sqrt((dx ** 2) + (dy ** 2))</span>
    <span class="c"># distance = numer / denom</span>
    <span class="c"># adapted from http://stackoverflow.com/questions/849211/shortest-distance-between-a-point-and-a-line-segment</span>
    <span class="n">squared_mag_of_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span>
    <span class="n">interpolation_factor</span> <span class="o">=</span> <span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">squared_mag_of_delta</span><span class="p">)</span>
    <span class="n">interpolation_factor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">interpolation_factor</span><span class="p">))</span>  <span class="c"># clamp to [0, 1]</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">interpolation_factor</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">interpolation_factor</span> <span class="o">*</span> <span class="n">dy</span>
    <span class="n">ndx</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="n">ndy</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">-</span> <span class="n">y0</span>
    <span class="n">squared_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">ndx</span> <span class="o">*</span> <span class="n">ndx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ndy</span> <span class="o">*</span> <span class="n">ndy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">squared_dist</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">dist</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="calc_handle_coords"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.calc_handle_coords">[docs]</a><span class="k">def</span> <span class="nf">calc_handle_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">polygon_center</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">polygon_dims</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">cx</span><span class="p">,</span> <span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>  <span class="c"># start at top edge</span>
    <span class="n">MIN_HANDLE_LENGTH</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">HANDLE_LENGTH</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MIN_HANDLE_LENGTH</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">HANDLE_LENGTH</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pts</span>

</div>
<div class="viewcode-block" id="make_handle_line"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.make_handle_line">[docs]</a><span class="k">def</span> <span class="nf">make_handle_line</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">calc_handle_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">)))</span>
    <span class="n">line_width</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">line_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_color</span><span class="p">)</span>
    <span class="n">marker_face_color</span> <span class="o">=</span> <span class="n">line_color</span>
    <span class="n">line_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;lw&#39;</span><span class="p">:</span> <span class="n">line_width</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s">&#39;mfc&#39;</span><span class="p">:</span> <span class="n">marker_face_color</span><span class="p">}</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span><span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lines</span>

</div>
<div class="viewcode-block" id="ANNOTATIONInteraction"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction">[docs]</a><span class="k">class</span> <span class="nc">ANNOTATIONInteraction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An interactive polygon editor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    verts_list : list of lists of (float, float)</span>
<span class="sd">        List of (x, y) coordinates used as vertices of the polygon.</span>
<span class="sd">    max_ds : float</span>
<span class="sd">        Max pixel distance to count as a vertex hit.</span>

<span class="sd">    Key-bindings</span>
<span class="sd">    ------------</span>
<span class="sd">    &#39;t&#39; : toggle vertex markers on and off.  When vertex markers are on,</span>
<span class="sd">          you can move them, delete them</span>
<span class="sd">    &#39;d&#39; : delete the vertex under point</span>
<span class="sd">    &#39;i&#39; : insert a vertex at point.  You must be within max_ds of the</span>
<span class="sd">          line connecting two existing vertices</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">img_ind</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">commit_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verts_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">bbox_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">theta_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">species_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">max_ds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">face_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                 <span class="n">fnum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">default_species</span><span class="o">=</span><span class="n">DEFAULT_SPECIES_TAG</span><span class="p">,</span>
                 <span class="n">next_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prev_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">do_mask</span><span class="o">=</span><span class="bp">False</span><span class="p">,):</span>
        <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fnum</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commit_callback</span> <span class="o">=</span> <span class="n">commit_callback</span>  <span class="c"># commit_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span> <span class="o">=</span> <span class="o">.</span><span class="mi">18</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span> <span class="o">=</span> <span class="o">.</span><span class="mi">08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
            <span class="p">(</span><span class="s">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_callback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_press_callback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_release_callback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_press_callback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_notify_callback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;resize_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_resize</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="k">def</span> <span class="nf">initialize_variables</span><span class="p">():</span>
            <span class="c"># Jon: I don&#39;t like this nested function. I want a better solution.</span>
            <span class="c">#self.next_callback = next_callback</span>
            <span class="c">#self.prev_callback = prev_callback</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_mask</span> <span class="o">=</span> <span class="n">do_mask</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_ind</span> <span class="o">=</span> <span class="n">img_ind</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_tag</span> <span class="o">=</span> <span class="n">default_species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_ds</span> <span class="o">=</span> <span class="n">max_ds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_default</span> <span class="o">=</span> <span class="n">face_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># mouse X coordinate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># mouse Y coordinate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indX</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indY</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">press1</span> <span class="o">=</span> <span class="bp">False</span>        <span class="c"># HACK (corner case): flag if polygon is highlighted</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canUncolor</span> <span class="o">=</span> <span class="bp">False</span>    <span class="c"># flag if the polygon SHOULD be active</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autoinc_polynum</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># num polys in image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="o">=</span> <span class="bp">False</span>                <span class="c"># if any poly is active</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># active polygon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Something Jon added</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">initialize_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_variables</span> <span class="o">=</span> <span class="n">initialize_variables</span>  <span class="c"># hack involving exploting lexical scoping to save defaults for a restore operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_matplotlib_initialization</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>
        <span class="c"># print(verts_list)</span>
        <span class="c"># test_list = verts_to_bbox(verts_list)</span>
        <span class="c"># print(test_list)</span>
        <span class="c"># Ensure that our input is in verts_list format</span>
        <span class="k">assert</span> <span class="n">verts_list</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;only one can be specified&#39;</span>
        <span class="c"># bbox_list will get converted to verts_list</span>
        <span class="k">if</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">verts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_to_verts</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">bbox_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">theta_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">species_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species_tag</span> <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">]</span>

        <span class="c"># Create the list of polygons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_polygon_creation</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># the active vert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currently_rotating_poly</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="s">&#39;wow. something is weird&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_action_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_callbacks</span><span class="p">(</span><span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">)</span>

<div class="viewcode-block" id="ANNOTATIONInteraction.handle_matplotlib_initialization"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.handle_matplotlib_initialization">[docs]</a>    <span class="k">def</span> <span class="nf">handle_matplotlib_initialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">instantiate_window</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instantiate_window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">close_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="c">#self.fig.cla()</span>
        <span class="c">#utool.qflag()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnum</span> <span class="o">=</span> <span class="n">fnum</span>
        <span class="c">#print(self.fnum)</span>
        <span class="c">#ax = plt.subplot(111)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">remove_patches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">((</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s">&#39;Click and drag to select/move/resize an ANNOTATION&#39;</span><span class="p">,</span>
            <span class="s">&#39;Press enter to clear the species tag of the selected ANNOTATION&#39;</span><span class="p">,</span>
            <span class="s">&#39;Type to set the species tag of the selected ANNOTATION&#39;</span><span class="p">,</span> <span class="p">])))</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.handle_polygon_creation"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.handle_polygon_creation">[docs]</a>    <span class="k">def</span> <span class="nf">handle_polygon_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">):</span>
        <span class="c"># Maintain original input</span>
        <span class="k">assert</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">theta_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">species_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">))]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta_list</span><span class="p">),</span> <span class="s">&#39;inconconsitent data1&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">),</span> <span class="s">&#39;inconconsitent data2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_indicies</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_bbox_list</span>    <span class="o">=</span> <span class="n">bbox_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_theta_list</span>   <span class="o">=</span> <span class="n">theta_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_species_list</span> <span class="o">=</span> <span class="n">species_list</span>
        <span class="c"># Convert bbox to verticies</span>
        <span class="n">verts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_to_verts</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">bbox_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">verts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enforce_dims</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
        <span class="c"># Create polygons</span>
        <span class="n">poly_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_polygon</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">is_orig</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                     <span class="k">for</span> <span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span> <span class="ow">in</span>
                     <span class="nb">zip</span><span class="p">(</span><span class="n">verts_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span> <span class="o">=</span> <span class="p">{</span><span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">:</span> <span class="n">poly</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">poly_list</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">wh_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">basecoords_to_bbox</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span>
                                <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)])</span>
            <span class="n">poly_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">wh_list</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">[</span><span class="n">poly_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">(</span><span class="n">poly_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_line</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># Add polygons and lines to the axis</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>
        <span class="c"># Give polygons mpl change callbacks</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_changed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.disconnect_mpl_callbacks"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.disconnect_mpl_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects all connected matplotlib callbacks &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">callbackid</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span><span class="p">):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">callbackid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.connect_mpl_callbacks"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.connect_mpl_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">connect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects matplotlib callbacks specified in the</span>
<span class="sd">        self.mpl_callback_ids dict &quot;&quot;&quot;</span>
        <span class="c">#http://matplotlib.org/1.3.1/api/backend_bases_api.html</span>
        <span class="c"># Create callback ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_mpl_callbacks</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_funcs</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.add_action_buttons"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.add_action_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">add_action_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">but_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span>
        <span class="n">but_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_ax</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">but_width</span><span class="p">,</span> <span class="n">but_height</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_but</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_ax</span><span class="p">,</span> <span class="s">&#39;Add Rectangle</span><span class="se">\n</span><span class="s">(ctrl+</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADD_RECTANGLE_HOTKEY</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_but</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">draw_new_poly</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">del_ax</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">but_width</span><span class="p">,</span> <span class="n">but_height</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_but</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">del_ax</span><span class="p">,</span> <span class="s">&#39;Delete Rectangle</span><span class="se">\n</span><span class="s">(ctrl+</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DEL_RECTANGLE_HOTKEY</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_but</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_current_poly</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">accept_ax</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.61</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">but_width</span><span class="p">,</span> <span class="n">but_height</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_but</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept_ax</span><span class="p">,</span> <span class="s">&#39;Accept and Save</span><span class="se">\n</span><span class="s">(ctrl+</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ACCEPT_SAVE_HOTKEY</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_but</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept_new_annotations</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.update_callbacks"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.update_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">update_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">):</span>
        <span class="n">but_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span>
        <span class="n">but_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span> <span class="o">=</span> <span class="n">prev_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span> <span class="o">=</span> <span class="n">next_callback</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">but_width</span><span class="p">,</span> <span class="n">but_height</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_but</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_ax</span><span class="p">,</span> <span class="s">&#39;Previous Annotation</span><span class="se">\n</span><span class="s">(left arrow)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_but</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_annotation</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">but_width</span><span class="p">,</span> <span class="n">but_height</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_but</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_ax</span><span class="p">,</span> <span class="s">&#39;Next Annotation</span><span class="se">\n</span><span class="s">(right arrow)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_but</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_annotation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.update_image_and_callbacks"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.update_image_and_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">update_image_and_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span>
                                   <span class="n">species_list</span><span class="p">,</span> <span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_matplotlib_initialization</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnum</span><span class="p">,</span> <span class="n">instantiate_window</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_polygon_creation</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_callbacks</span><span class="p">(</span><span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] drawing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.next_annotation"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.next_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">next_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.prev_annotation"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.prev_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">prev_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.on_resize"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.on_resize">[docs]</a>    <span class="k">def</span> <span class="nf">on_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c">#print(utool.dict_str(event.__dict__))</span>
        <span class="c">#self.fig.canvas.draw()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="c">#self.fig.canvas.update()</span>
        <span class="c">#self.fig.canvas.update()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.show"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bring_to_front</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.draw"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.bring_to_front"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.bring_to_front">[docs]</a>    <span class="k">def</span> <span class="nf">bring_to_front</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">bring_to_front</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.next_polynum"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.next_polynum">[docs]</a>    <span class="k">def</span> <span class="nf">next_polynum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoinc_polynum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoinc_polynum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">num</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.update_colors"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.update_colors">[docs]</a>    <span class="k">def</span> <span class="nf">update_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly_ind</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">poly_ind</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">poly_ind</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] WARNING: poly_ind is </span><span class="si">%r</span><span class="s"> in update_colors&#39;</span> <span class="o">%</span> <span class="n">poly_ind</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">lines</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;white&#39;</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">[</span><span class="n">poly_ind</span><span class="p">]</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">ORANGE</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.update_UI"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.update_UI">[docs]</a>    <span class="k">def</span> <span class="nf">update_UI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_line</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_artists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.draw_callback"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.draw_callback">[docs]</a>    <span class="k">def</span> <span class="nf">draw_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_artists</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.draw_artists"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.draw_artists">[docs]</a>    <span class="k">def</span> <span class="nf">draw_artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.poly_changed"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.poly_changed">[docs]</a>    <span class="k">def</span> <span class="nf">poly_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; this method is called whenever the polygon object is called &quot;&quot;&quot;</span>
        <span class="c"># only copy the artist props to the line (except visibility)</span>
        <span class="c">#num = poly.num</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="c">#Artist.update_from(poly.lines, poly)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
        <span class="c">#poly.lines.set_visible(vis)  # don&#39;t use the poly visibility state</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.get_most_recently_added_poly"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.get_most_recently_added_poly">[docs]</a>    <span class="k">def</span> <span class="nf">get_most_recently_added_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">poly_ind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c"># most recently added polygon has the highest index</span>
            <span class="k">return</span> <span class="n">poly_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">[</span><span class="n">poly_ind</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.button_press_callback"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.button_press_callback">[docs]</a>    <span class="k">def</span> <span class="nf">button_press_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; whenever a mouse button is pressed &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c"># leftclick</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">is_within_distance_from_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_ds</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">),</span> <span class="n">calc_handle_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currently_rotating_poly</span> <span class="o">=</span> <span class="n">poly</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] WARNING: Polygon unknown. Using last placed poly.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] No polygons on screen&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">poly_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">(</span><span class="n">poly_ind</span><span class="p">)</span>
        <span class="n">polyind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ind_under_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">polyind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">[</span><span class="n">polyind</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">(</span><span class="n">polyind</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
            <span class="c">#self._currently_selected_poly.set_facecolor(&#39;red&#39;)</span>
            <span class="c">#self._currently_selected_poly.lines.set_color(&#39;red&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">press1</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canUncolor</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_line</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] error: self.background is none. Trying refresh.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.button_release_callback"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.button_release_callback">[docs]</a>    <span class="k">def</span> <span class="nf">button_release_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; whenever a mouse button is released &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># and (self._ind is None or self.press1 is False):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">currently_rotating_poly</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ignore</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">press1</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canUncolor</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c">#self._currently_selected_poly.set_facecolor(&#39;white&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">press1</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] WARNING: Polygon unknown. Using default. (2)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] No polygons on screen&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">poly_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
        <span class="n">currX</span><span class="p">,</span> <span class="n">currY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indX</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">indY</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indX</span> <span class="o">-</span> <span class="n">currX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indY</span> <span class="o">-</span> <span class="n">currY</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">or</span>
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">press1</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c">#self._currently_selected_poly = None</span>
            <span class="c">#self.update_colors(None)</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.draw_new_poly"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.draw_new_poly">[docs]</a>    <span class="k">def</span> <span class="nf">draw_new_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">defaultshape_polys</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">num</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">defaultshape_polys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">default_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">defaultshape_polys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span><span class="p">)</span>

        <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_polygon</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_tag</span><span class="p">)</span>

        <span class="c">#&lt;hack reason=&quot;brittle resizing algorithm that doesn&#39;t work unless the points are in the right order, see resize_rectangle&quot;&gt;</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">bbox_to_verts</span><span class="p">(</span><span class="n">basecoords_to_bbox</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">))</span>
        <span class="n">set_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="c">#&lt;/hack&gt;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">poly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_line</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>

        <span class="n">poly</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># the active vert</span>
        <span class="n">poly_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">poly_ind</span> <span class="o">==</span> <span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="s">&#39;ind </span><span class="si">%r</span><span class="s">, num </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">poly_ind</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">(</span><span class="n">poly_ind</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.delete_current_poly"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.delete_current_poly">[docs]</a>    <span class="k">def</span> <span class="nf">delete_current_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] No polygon selected to delete&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span>
        <span class="n">lineNumber</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">num</span>
        <span class="c">###print(&#39;poly list: &#39;, len(self.poly_list), &#39;list size &#39;, len(self.line), &#39;index of poly &#39;, lineNumber)</span>

        <span class="c">#line deletion</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] length: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">),</span> <span class="s">&#39;number: &#39;</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">)</span>
        <span class="c">#self.theta_list[lineNumber] = None</span>
        <span class="c">#self.line[lineNumber] = None</span>
        <span class="c">#poly deletion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lineNumber</span><span class="p">)</span>
        <span class="c">#self.poly_list.remove(poly)</span>
        <span class="c">#remove the poly from the figure itself</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="c">#reset anything that has to do with current poly</span>
        <span class="n">poly_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">poly_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">(</span><span class="n">poly_ind</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.load_points"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.load_points">[docs]</a>    <span class="k">def</span> <span class="nf">load_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.toggle_species_label"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.toggle_species_label">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_species_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] toggle_species_label()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.key_press_callback"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.key_press_callback">[docs]</a>    <span class="k">def</span> <span class="nf">key_press_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; whenever a key is pressed &quot;&quot;&quot;</span>
        <span class="c">#print(&#39;[interact_annot] key_press_callback&#39;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">handle_command</span><span class="p">(</span><span class="n">keychar</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] got hotkey=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">keychar</span><span class="p">,))</span>
            <span class="k">if</span> <span class="n">keychar</span> <span class="o">==</span> <span class="n">ACCEPT_SAVE_HOTKEY</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accept_new_annotations</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">keychar</span> <span class="o">==</span> <span class="n">ADD_RECTANGLE_HOTKEY</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_new_poly</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">keychar</span> <span class="o">==</span> <span class="n">DEL_RECTANGLE_HOTKEY</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_current_poly</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">keychar</span> <span class="o">==</span> <span class="n">TOGGLE_LABEL_HOTKEY</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toggle_species_label</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">keychar</span> <span class="o">==</span> <span class="s">&#39;u&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_points</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">keychar</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] fignums=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">(),))</span>

        <span class="k">def</span> <span class="nf">handle_label_typing</span><span class="p">(</span><span class="n">keychar</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="n">keychar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c"># perfect use case for anaphoric if, or assignment in if statements (if python had either)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^ctrl\+(.)$&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">handle_command</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="c"># enter clears the species tag, workaround since matplotlib doesn&#39;t seem</span>
        <span class="c"># to trigger &#39;key_press_event&#39;s for backspace (which would be the</span>
        <span class="c"># preferred interface)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^enter$&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^.$&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">handle_label_typing</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.motion_notify_callback"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.motion_notify_callback">[docs]</a>    <span class="k">def</span> <span class="nf">motion_notify_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; on mouse movement &quot;&quot;&quot;</span>
        <span class="c">#print(&#39;motion_notify_callback&#39;)</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># uses boolean punning for terseness</span>
            <span class="n">lastX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="ow">or</span> <span class="bp">None</span>
            <span class="n">lastY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="ow">or</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
            <span class="c">#print(&#39;mouse coords %r, %r; previous %r, %r&#39; % (self.mouseX, self.mouseY, lastX, lastY))</span>
            <span class="n">deltaX</span> <span class="o">=</span> <span class="n">lastX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="o">-</span> <span class="n">lastX</span>
            <span class="n">deltaY</span> <span class="o">=</span> <span class="n">lastY</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">-</span> <span class="n">lastY</span>

        <span class="k">if</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">press1</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canUncolor</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resize_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currently_rotating_poly</span><span class="p">:</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currently_rotating_poly</span>
                <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">polygon_center</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span><span class="p">,</span> <span class="n">cx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">tau</span> <span class="o">/</span> <span class="mi">4</span>
                <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rotate_rectangle</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># move all vertices</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">deltaX</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">deltaY</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">move_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="p">,</span> <span class="n">deltaX</span><span class="p">,</span> <span class="n">deltaY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.onpick"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.onpick">[docs]</a>    <span class="k">def</span> <span class="nf">onpick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Makes selected polygon translucent &quot;&quot;&quot;</span>
        <span class="c">#print(&#39;onpick&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
        <span class="c">#x, y = event.mouseevent.xdata, event.mouseevent.xdata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_polyHeld</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.mouse_enter"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.mouse_enter">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c">#print(&#39;mouse_enter&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.mouse_leave"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.mouse_leave">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c">#print(&#39;mouse_leave&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currently_selected_poly</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.check_dims"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.check_dims">[docs]</a>    <span class="k">def</span> <span class="nf">check_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
            <span class="c">#coords[0] = xlim[0]</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
            <span class="c">#coords[0] = xlim[1]</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
            <span class="c">#coords[1] = ylim[1]</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
            <span class="c">#coords[1] = ylim[0]</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="c"># ONLY USE THIS ON UNROTATED RECTANGLES, as to do otherwise may yield arbitrary polygons</span></div>
<div class="viewcode-block" id="ANNOTATIONInteraction.enforce_dims"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.enforce_dims">[docs]</a>    <span class="k">def</span> <span class="nf">enforce_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.clip_vert_to_bounds"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.clip_vert_to_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">clip_vert_to_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">clamp</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">clamp</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">clamp</span><span class="p">(</span><span class="n">ylim</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.check_valid_coords"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.check_valid_coords">[docs]</a>    <span class="k">def</span> <span class="nf">check_valid_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords_list</span><span class="p">):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_dims</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">valid</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.rotate_rectangle"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.rotate_rectangle">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">):</span>
        <span class="c">#print(&#39;rotate_rectangle&#39;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_valid_coords</span><span class="p">(</span><span class="n">calc_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">dtheta</span><span class="p">)):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">+=</span> <span class="n">dtheta</span>
            <span class="n">set_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.move_rectangle"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.move_rectangle">[docs]</a>    <span class="k">def</span> <span class="nf">move_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="c">#print(&#39;move_rectangle&#39;)</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_valid_coords</span><span class="p">(</span><span class="n">calc_display_coords</span><span class="p">(</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">new_coords</span>
            <span class="n">set_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.resize_rectangle"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.resize_rectangle">[docs]</a>    <span class="k">def</span> <span class="nf">resize_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c">#print(&#39;resize_rectangle&#39;)</span>
        <span class="k">if</span> <span class="n">poly</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">polarDelta</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">mag</span><span class="p">,</span> <span class="n">theta</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">apply_polarDelta</span><span class="p">(</span><span class="n">poldelt</span><span class="p">,</span> <span class="n">cart</span><span class="p">):</span>
            <span class="n">newx</span> <span class="o">=</span> <span class="n">cart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">cart</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">newx</span><span class="p">,</span> <span class="n">newy</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">isSegmentBetweenCoordsVertical</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># x coordinates are the same</span>

        <span class="k">def</span> <span class="nf">rad2deg</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tau</span>

        <span class="c"># the minus one is because the last coordinate is duplicated (by matplotlib) to get a closed polygon</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#tmpcoords = rotate_points_around(tmpcoords, -poly.theta, *polygon_center(poly))</span>
        <span class="c">#tmpcoords = list(poly.basecoords[:-1])</span>
        <span class="k">def</span> <span class="nf">wrapIndex</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">))</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span>
        <span class="n">previdx</span><span class="p">,</span> <span class="n">nextidx</span> <span class="o">=</span> <span class="n">wrapIndex</span><span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">wrapIndex</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c">#oppidx = wrapIndex(idx + 2)</span>
        <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="c">#(total_dx, total_dy) = (x - poly.xy[idx][0], y - poly.xy[idx][1])</span>
        <span class="c">#higher_delta = max(total_dx, total_dy)</span>
        <span class="c">#print(&#39;total (%r, %r), heigher = %r&#39; % (total_dx, total_dy, higher_delta))</span>
        <span class="c">#for i in range(0, int(higher_delta)):</span>
        <span class="c">#    (dx, dy) = (total_dx / higher_delta, total_dy / higher_delta)</span>
        <span class="c">#    print(&#39;dx dy (%r, %r)&#39; % (dx, dy))</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#tmpcoords[idx] = (tmpcoords[idx][0] + dx, tmpcoords[idx][1] + dy)</span>

        <span class="c">#a#newx, newy = tmpcoords[idx][0], tmpcoords[idx][1]</span>
        <span class="c">#a#oppx, oppy = tmpcoords[oppidx][0], tmpcoords[oppidx][1]</span>
        <span class="c">#a#prevx, prevy = tmpcoords[previdx][0], tmpcoords[previdx][1]</span>
        <span class="c">#a#nextx, nexty = tmpcoords[nextidx][0], tmpcoords[nextidx][1]</span>
        <span class="c">#a#</span>
        <span class="c">#a#hypotenuse_new_opp = distance(oppy - newy, oppx - newx) # green line</span>
        <span class="c">#a#</span>
        <span class="c">#a#</span>
        <span class="c">#a#angle_xaxis_opp_new = math.atan2(oppy - newy, oppx - newx) # black theta</span>
        <span class="c">#a#angle_xaxis_opp_newprev = math.atan2(oppy - prevy, oppx - prevx) # blue theta</span>
        <span class="c">#a#angle_newprev_opp_new = angle_xaxis_opp_new - angle_xaxis_opp_newprev # red theta</span>
        <span class="c">#a#hypotenuse_opp_newprev = hypotenuse_new_opp * math.cos(angle_xaxis_opp_new)</span>
        <span class="c">#a#</span>
        <span class="c">#a#newprev_x = hypotenuse_opp_newprev * math.cos(angle_xaxis_opp_newprev)</span>
        <span class="c">#a#newprev_y = hypotenuse_opp_newprev * math.sin(angle_xaxis_opp_newprev)</span>
        <span class="c">#a#tmpcoords[previdx] = (newprev_x, newprev_y)</span>
        <span class="c">#a#</span>
        <span class="c">#a#</span>
        <span class="c">#a#angle_xaxis_opp_new = math.atan2(oppy - newy, oppx - newx)</span>
        <span class="c">#a#angle_xaxis_opp_newnext = math.atan2(oppy - nexty, oppx - nextx)</span>
        <span class="c">#a#angle_newnext_opp_new = angle_xaxis_opp_new - angle_xaxis_opp_newnext</span>
        <span class="c">#a#hypotenuse_opp_newnext = hypotenuse_new_opp * math.sin(angle_xaxis_opp_new)</span>
        <span class="c">#a#</span>
        <span class="c">#a#newnext_x = hypotenuse_opp_newnext * math.cos(angle_xaxis_opp_newnext)</span>
        <span class="c">#a#newnext_y = hypotenuse_opp_newnext * math.sin(angle_xaxis_opp_newnext)</span>
        <span class="c">#a#tmpcoords[nextidx] = (newnext_x, newnext_y)</span>

        <span class="c"># this algorithm worked the best of the ones I tried, but needs</span>
        <span class="c"># &quot;experimentally determined constants&quot; to work properly, since I failed</span>
        <span class="c"># to properly derive them in the allotted time</span>
        <span class="n">FUDGE_FACTORS</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tau</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span>
                         <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tau</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span>
                         <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tau</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)}</span>

        <span class="n">polar_idx2prev</span> <span class="o">=</span> <span class="n">polarDelta</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">previdx</span><span class="p">])</span>
        <span class="n">polar_idx2next</span> <span class="o">=</span> <span class="n">polarDelta</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">nextidx</span><span class="p">])</span>
        <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
        <span class="n">mag_delta</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="n">theta_delta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">poly_theta</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">FUDGE_FACTORS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">theta_rot</span> <span class="o">=</span> <span class="n">theta_delta</span> <span class="o">-</span> <span class="p">(</span><span class="n">poly_theta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tau</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c">##print(&#39;poly.theta %r&#39; % rad2deg(poly.theta))</span>
        <span class="c">##print(&#39;poly_theta %r&#39; % rad2deg(poly_theta))</span>
        <span class="c">##print(&#39;theta_delta %r&#39; % rad2deg(theta_delta))</span>
        <span class="c">##print(&#39;theta_rot %r&#39; % rad2deg(theta_rot))</span>
        <span class="n">rotx</span> <span class="o">=</span> <span class="n">mag_delta</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rot</span><span class="p">)</span>
        <span class="n">roty</span> <span class="o">=</span> <span class="n">mag_delta</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rot</span><span class="p">)</span>
        <span class="n">polar_idx2prev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">rotx</span>
        <span class="n">polar_idx2next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">roty</span>
        <span class="n">tmpcoords</span><span class="p">[</span><span class="n">previdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_polarDelta</span><span class="p">(</span><span class="n">polar_idx2prev</span><span class="p">,</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">tmpcoords</span><span class="p">[</span><span class="n">nextidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_polarDelta</span><span class="p">(</span><span class="n">polar_idx2next</span><span class="p">,</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="c"># rotate the points by -theta to get the &quot;unrotated&quot; points for use as basecoords</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">,</span> <span class="o">-</span><span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">polygon_center</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span>
        <span class="c"># ensure the poly is closed, matplotlib might do this, but I&#39;m not sure</span>
        <span class="c"># if it preserves the ordering we depend on, even if it does add the</span>
        <span class="c"># point</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">tmpcoords</span><span class="p">[:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tmpcoords</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">def</span> <span class="nf">within_epsilon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="o">.</span><span class="mo">000001</span>

        <span class="k">def</span> <span class="nf">meets_minimum_width_and_height</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">MIN_W</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">MIN_H</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Depends on hardcoded indicies, which is inelegant, but</span>
<span class="sd">            we&#39;re already depending on those for the FUDGE_FACTORS</span>
<span class="sd">            array above</span>
<span class="sd">            1----2</span>
<span class="sd">            |    |</span>
<span class="sd">            0----3</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c"># the seperate 1 and 2 variables are not strictly necessary, but</span>
            <span class="c"># provide a sanity check to ensure that we&#39;re dealing with the right</span>
            <span class="c"># shape</span>
            <span class="n">width1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">width2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">within_epsilon</span><span class="p">(</span><span class="n">width1</span><span class="p">,</span> <span class="n">width2</span><span class="p">),</span> <span class="s">&#39;w1: </span><span class="si">%r</span><span class="s">, w2: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">width1</span><span class="p">,</span> <span class="n">width2</span><span class="p">)</span>
            <span class="n">height1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">height2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">within_epsilon</span><span class="p">(</span><span class="n">height1</span><span class="p">,</span> <span class="n">height2</span><span class="p">),</span> <span class="s">&#39;h1: </span><span class="si">%r</span><span class="s">, h2: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">height1</span><span class="p">,</span> <span class="n">height2</span><span class="p">)</span>
            <span class="c">#print(&#39;w, h = (%r, %r)&#39; % (width1, height1))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">MIN_W</span> <span class="o">&lt;</span> <span class="n">width1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">MIN_H</span> <span class="o">&lt;</span> <span class="n">height1</span><span class="p">)</span>

            <span class="c">#b#def pairs(slicable):</span>
            <span class="c">#b#    return zip(slicable[:-1], slicable[1:])</span>
            <span class="c">#b#def is_rectangle(coords):</span>
            <span class="c">#b#    first_samex = within_epsilon(coords[0][0], coords[1][0])</span>
            <span class="c">#b#    which_to_compare = 0 if first_samex else 1</span>
            <span class="c">#b#    for p1, p2 in pairs(coords):</span>
            <span class="c">#b#        if not within_epsilon(p1[which_to_compare], p2[which_to_compare]):</span>
            <span class="c">#b#            return False</span>
            <span class="c">#b#        else:</span>
            <span class="c">#b#            which_to_compare = 0 if which_to_compare == 1 else 0</span>
            <span class="c">#b#    return True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_valid_coords</span><span class="p">(</span><span class="n">calc_display_coords</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">))</span> <span class="ow">and</span> <span class="n">meets_minimum_width_and_height</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">tmpcoords</span>

        <span class="n">set_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_update_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># save verts because polygon gets deleted when figure is closed</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_vert_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)))</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">calc_handle_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">))))</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="ANNOTATIONInteraction.get_ind_under_cursor"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.get_ind_under_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">get_ind_under_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the index of the vertex under cursor if within max_ds tolerance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print(&#39;[interact_annotion] enter get_ind_under_cursor&#39;)</span>
        <span class="k">def</span> <span class="nf">get_ind_and_dist</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">poly</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">xyt</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">xt</span><span class="p">,</span> <span class="n">yt</span> <span class="o">=</span> <span class="n">xyt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyt</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xt</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yt</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">indseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">d</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">indseq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">mindist</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mindist</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_ds</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">mindist</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">mindist</span><span class="p">)</span>
        <span class="n">ind_dist_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">#for poly in self.poly_list:</span>
        <span class="c">#    if poly is not None:</span>
        <span class="c">#        ind_dist_list.append(get_ind_and_dist(poly))</span>
        <span class="n">ind_dist_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">polyind</span><span class="p">,</span> <span class="n">get_ind_and_dist</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">polyind</span><span class="p">,</span> <span class="n">poly</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)]</span>
        <span class="n">min_dist</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">min_ind</span>  <span class="o">=</span> <span class="bp">None</span>
        <span class="n">sel_polyind</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">polyind</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ind_dist_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">min_dist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">min_ind</span> <span class="o">=</span> <span class="n">ind</span>
                <span class="n">sel_polyind</span> <span class="o">=</span> <span class="n">polyind</span>
            <span class="k">elif</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>
                <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">min_ind</span> <span class="o">=</span> <span class="n">ind</span>
                <span class="n">sel_polyind</span> <span class="o">=</span> <span class="n">polyind</span>
        <span class="c">#print(&#39;[interact_annotion] exit get_ind_under_cursor, (%r, %r)&#39; % (sel_polyind, min_ind))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sel_polyind</span><span class="p">,</span> <span class="n">min_ind</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.new_polygon"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.new_polygon">[docs]</a>    <span class="k">def</span> <span class="nf">new_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span>
                    <span class="n">face_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">line_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">is_orig</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; verts - list of (x, y) tuples &quot;&quot;&quot;</span>
        <span class="c"># create new polygon from verts</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">face_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c"># register this polygon</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_polynum</span><span class="p">()</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&#39;orig&#39;</span> <span class="k">if</span> <span class="n">is_orig</span> <span class="k">else</span> <span class="s">&#39;new&#39;</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_lines</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">line_color</span><span class="p">,</span> <span class="n">line_width</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">make_handle_line</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">tagpos</span> <span class="o">=</span> <span class="n">calc_tag_position</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">tagpos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tagpos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">species</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s">&#39;white&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c"># eliminate &quot;leftover&quot; copies</span>
        <span class="k">return</span> <span class="n">poly</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.make_lines"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.make_lines">[docs]</a>    <span class="k">def</span> <span class="nf">make_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">line_color</span><span class="p">,</span> <span class="n">line_width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; verts - list of (x, y) tuples &quot;&quot;&quot;</span>
        <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_color</span><span class="p">)</span>
        <span class="n">marker_face_color</span> <span class="o">=</span> <span class="n">line_color</span>
        <span class="n">line_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;lw&#39;</span><span class="p">:</span> <span class="n">line_width</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s">&#39;mfc&#39;</span><span class="p">:</span> <span class="n">marker_face_color</span><span class="p">}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span><span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kwargs</span><span class="p">)</span>
        <span class="c">#print(&#39;[interact_annot] make_lines: linetype = %r&#39; % type(lines))</span>
        <span class="k">return</span> <span class="n">lines</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.accept_new_annotations"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.accept_new_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">accept_new_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">do_close</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write a callback to redraw viz for bbox_list&quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] Pressed Accept Button&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_annottup_list</span><span class="p">():</span>
            <span class="n">annottup_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">indicies_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c">#theta_list = []</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                <span class="n">index</span>   <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">num</span>
                <span class="n">bbox</span>    <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">basecoords_to_bbox</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">)))</span>
                <span class="n">theta</span>   <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">annottup</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">indicies_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">annottup_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annottup</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">indicies_list</span><span class="p">,</span> <span class="n">annottup_list</span>

        <span class="k">def</span> <span class="nf">send_back_annotations</span><span class="p">():</span>
            <span class="c">#point_list = self.load_points()</span>
            <span class="c">#theta_list = self.theta_list</span>
            <span class="c">#new_bboxes = verts_to_bbox(point_list)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] send_back_annotations&#39;</span><span class="p">)</span>
            <span class="n">indicies_list</span><span class="p">,</span> <span class="n">annottup_list</span> <span class="o">=</span> <span class="n">get_annottup_list</span><span class="p">()</span>
            <span class="c"># Delete if index is in original_indicies but no in indicies_list</span>
            <span class="n">deleted_indicies</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_indicies</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">indicies_list</span><span class="p">))</span>
            <span class="n">changed_indicies</span>   <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unchanged_indicies</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># sanity check</span>
            <span class="n">changed_annottups</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_annottups</span>      <span class="o">=</span> <span class="p">[]</span>
            <span class="n">original_annottup_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_bbox_list</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">original_theta_list</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">original_species_list</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">annottup</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indicies_list</span><span class="p">,</span> <span class="n">annottup_list</span><span class="p">):</span>
                <span class="c"># If the index is not in the originals then it is new</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_indicies</span><span class="p">:</span>
                    <span class="n">new_annottups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annottup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">annottup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_annottup_list</span><span class="p">:</span>
                        <span class="n">changed_annottups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annottup</span><span class="p">)</span>
                        <span class="n">changed_indicies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">unchanged_indicies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commit_callback</span><span class="p">(</span><span class="n">unchanged_indicies</span><span class="p">,</span> <span class="n">deleted_indicies</span><span class="p">,</span> <span class="n">changed_indicies</span><span class="p">,</span> <span class="n">changed_annottups</span><span class="p">,</span> <span class="n">new_annottups</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">send_back_annotations</span><span class="p">()</span>
        <span class="c">#else:</span>
            <span class="c">#just print the updated points</span>
            <span class="c">#self.load_points()</span>
            <span class="c">#print(self.poly_list)</span>
        <span class="c"># Make mask from selection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mask</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="c"># User must close previous figure</span>
            <span class="c"># Modify the image with the mask</span>
            <span class="n">masked_img</span> <span class="o">=</span> <span class="n">apply_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="c"># show the modified image</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">masked_img</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Region outside of mask is darkened&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] Accept Over&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_close</span><span class="p">:</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">close_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="c">#plt.close(self.fnum)</span>
        <span class="c">#plt.draw()</span>
</div>
<div class="viewcode-block" id="ANNOTATIONInteraction.get_mask"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATIONInteraction.get_mask">[docs]</a>    <span class="k">def</span> <span class="nf">get_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return image mask given by mask creator&quot;&quot;&quot;</span>
        <span class="n">mask_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">verts_to_mask</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] No polygons to make mask out of&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mask_</span> <span class="ow">in</span> <span class="n">mask_list</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask</span>

</div></div>
<div class="viewcode-block" id="default_vertices"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.default_vertices">[docs]</a><span class="k">def</span> <span class="nf">default_vertices</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">polys</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mouseX</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mouseY</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Default to rectangle that has a quarter-width/height border.&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="c"># Center the new verts around wherever the mouse is</span>
    <span class="k">if</span> <span class="n">mouseX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">mouseY</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="n">mouseX</span>
        <span class="n">center_h</span> <span class="o">=</span> <span class="n">mouseY</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">center_h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">polys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Use the largest polygon size as the default verts</span>
        <span class="n">wh_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">basecoords_to_bbox</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span>
                            <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">polys</span><span class="p">)])</span>
        <span class="n">w_</span><span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="n">wh_list</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># If no poly exists use 1/4 of the image size</span>
        <span class="n">w_</span><span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c"># Get the x/y extents by offseting the centers</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_x</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_h</span><span class="p">,</span> <span class="n">center_h</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">h_</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="c"># Clip to bounds</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span>


<span class="c"># def update_lists(self, img_ind, new_verts_list, new_thetas_list, new_indices_list):</span>
<span class="c">#         &quot;&quot;&quot;for each image: know if any bboxes changed, if any have been deleted, know if any new bboxes</span>
<span class="c">#         pass all of this information to a function callback, so Jon can use the information&quot;&quot;&quot;</span>
<span class="c">#         print(&quot;[interact_annot] before: &quot;,self.aids_list[img_ind])</span>
<span class="c">#         self.aids_list[img_ind] = new_aids</span>
<span class="c">#         print(&quot;[interact_annot] after: &quot;, self.aids_list[img_ind])</span>

<span class="c">#         &quot;&quot;&quot;add function call for redrawing the ANNOTATIONs&quot;&quot;&quot;</span>

</div>
<div class="viewcode-block" id="ANNOTATION_creator"><a class="viewcode-back" href="../../plottool.html#plottool.interact_annotations.ANNOTATION_creator">[docs]</a><span class="k">def</span> <span class="nf">ANNOTATION_creator</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">verts_list</span><span class="p">):</span>  <span class="c"># add callback as variable</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] *** START DEMO ***&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verts_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">verts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_vertices</span><span class="p">(</span><span class="n">img</span><span class="p">)]</span>
    <span class="c"># else:</span>
    <span class="c">#     for verts in verts_list:</span>
    <span class="c">#         if (len(verts) is not 5):</span>
    <span class="c">#             print(&quot;verts list is not of correct length. &quot;, len(verts))</span>
    <span class="c">#             return</span>

    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">img_url</span> <span class="o">=</span> <span class="s">&#39;http://i.imgur.com/Vq9CLok.jpg&#39;</span>
            <span class="n">img_fpath</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">grab_file_url</span><span class="p">(</span><span class="n">img_url</span><span class="p">)</span>
            <span class="c">#img = mpimg.imread(img_fpath)</span>
            <span class="kn">from</span> <span class="nn">vtool</span> <span class="kn">import</span> <span class="n">image</span> <span class="k">as</span> <span class="n">gtool</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">gtool</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_fpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[interact_annot] cant read zebra: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="c">#test_bbox = verts_to_bbox(verts_list)</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">ANNOTATIONInteraction</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">verts_list</span><span class="o">=</span><span class="n">verts_list</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># NOQA</span>
    <span class="c"># Do interaction</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c"># Make mask from selection</span>
    <span class="c">#mask = mc.get_mask(img.shape)</span>
    <span class="c"># User must close previous figure</span>
    <span class="c"># Modify the image with the mask</span>
    <span class="c">#masked_img = apply_mask(img, mask)</span>
    <span class="c"># show the modified image</span>
    <span class="c">#plt.imshow(masked_img)</span>
    <span class="c">#plt.title(&#39;Region outside of mask is darkened&#39;)</span>
    <span class="c">#print(&#39;show2&#39;)</span>
    <span class="c">#plt.show()</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">#verts = [[0,0,400,400]]</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">)),</span>
             <span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">),</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">700</span><span class="p">),</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">))]</span>
    <span class="n">ANNOTATION_creator</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">verts_list</span><span class="o">=</span><span class="n">verts</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">plottool 1.0.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../plottool.html" >plottool</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jon Crall.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>